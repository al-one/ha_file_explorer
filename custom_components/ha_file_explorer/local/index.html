<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!--[if IE]><link rel="icon" href="favicon.ico"><![endif]-->
  <link rel="stylesheet" href="https://unpkg.com/@mdi/font@5.9.55/css/materialdesignicons.min.css">
  <title>文件管理 - File Explorer</title>
  <script src="https://unpkg.com/ace-builds@1.4.12/src-min-noconflict/ace.js"
    onerror="this.src = 'js/src-min-noconflict/ace.js'"></script>
  <style>
    ::-webkit-scrollbar-track {
      box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
      background-color: #F5F5F5;
    }

    ::-webkit-scrollbar {
      width: 10px;
      background-color: #F5F5F5;
    }

    ::-webkit-scrollbar-thumb {
      background-color: #1b76d2;
      background-image: -webkit-gradient(linear, 0 0, 0 100%,
          color-stop(.5, rgba(255, 255, 255, .2)),
          color-stop(.5, transparent), to(transparent));
    }
  </style>
  <link href="css/chunk-0486b194.01cf6fd8.css" rel="prefetch">
  <link href="css/chunk-10d0807f.a5decad6.css" rel="prefetch">
  <link href="css/chunk-1655e5b6.a5c6e440.css" rel="prefetch">
  <link href="css/chunk-1747b17e.01cf6fd8.css" rel="prefetch">
  <link href="css/chunk-2fdff89c.bc1b9fdf.css" rel="prefetch">
  <link href="css/chunk-35d96bf8.7d887a01.css" rel="prefetch">
  <link href="css/chunk-46887928.a5decad6.css" rel="prefetch">
  <link href="css/chunk-543c295d.01cf6fd8.css" rel="prefetch">
  <link href="css/chunk-5c732be6.01cf6fd8.css" rel="prefetch">
  <link href="css/chunk-64922f76.681a6b6f.css" rel="prefetch">
  <link href="css/chunk-6fbb8d7f.6069453a.css" rel="prefetch">
  <link href="css/chunk-7cc5e0d6.15fe9a91.css" rel="prefetch">
  <link href="css/chunk-7ff8088c.01cf6fd8.css" rel="prefetch">
  <link href="css/chunk-a2d7322e.fae4c610.css" rel="prefetch">
  <link href="css/chunk-ca64ef86.01cf6fd8.css" rel="prefetch">
  <link href="css/chunk-d7e5c3c0.4486b097.css" rel="prefetch">
  <link href="js/chunk-0486b194.6e0261b7.js" rel="prefetch">
  <link href="js/chunk-10d0807f.6c5c9bb1.js" rel="prefetch">
  <link href="js/chunk-1655e5b6.3cfb29df.js" rel="prefetch">
  <link href="js/chunk-1747b17e.90728011.js" rel="prefetch">
  <link href="js/chunk-2d0b2007.765cd12e.js" rel="prefetch">
  <link href="js/chunk-2d0ccbf6.a23473b6.js" rel="prefetch">
  <link href="js/chunk-2d0daf50.6675eb8c.js" rel="prefetch">
  <link href="js/chunk-2d0e88ff.a6a3850e.js" rel="prefetch">
  <link href="js/chunk-2fdff89c.99f3086d.js" rel="prefetch">
  <link href="js/chunk-35d96bf8.ccbfddf7.js" rel="prefetch">
  <link href="js/chunk-46887928.31127439.js" rel="prefetch">
  <link href="js/chunk-543c295d.36deb575.js" rel="prefetch">
  <link href="js/chunk-5c732be6.f8f83240.js" rel="prefetch">
  <link href="js/chunk-6023431e.73e192a5.js" rel="prefetch">
  <link href="js/chunk-64922f76.4550cdfa.js" rel="prefetch">
  <link href="js/chunk-6fbb8d7f.ac164e5a.js" rel="prefetch">
  <link href="js/chunk-772fe7bd.fd8c19b0.js" rel="prefetch">
  <link href="js/chunk-7cc5e0d6.4081b169.js" rel="prefetch">
  <link href="js/chunk-7ff8088c.37fa3606.js" rel="prefetch">
  <link href="js/chunk-a2d7322e.629a677a.js" rel="prefetch">
  <link href="js/chunk-ca64ef86.b3cdc466.js" rel="prefetch">
  <link href="js/chunk-d7e5c3c0.a5b209a9.js" rel="prefetch">
  <link href="css/chunk-vendors.bb0829cd.css" rel="preload" as="style">
  <link href="js/app.356b1d21.js" rel="preload" as="script">
  <link href="js/chunk-vendors.f06a1e0f.js" rel="preload" as="script">
  <link href="css/chunk-vendors.bb0829cd.css" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="32x32" href="img/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="img/icons/favicon-16x16.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4DBA87">
  <meta name="apple-mobile-web-app-capable" content="no">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ha_file_explorer">
  <link rel="apple-touch-icon" href="img/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="img/icons/safari-pinned-tab.svg" color="#4DBA87">
  <meta name="msapplication-TileImage" content="img/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
</head>

<body><noscript><strong>We're sorry but 文件管理 - File Explorer doesn't work properly without JavaScript enabled. Please
      enable it to continue.</strong></noscript>
  <div id="app"></div>
  <script>class HA {
      constructor() {
        // url参数
        let query = new URLSearchParams(location.search)
        this.query = (key) => {
          let val = query.get(key)
          if (val) {
            return decodeURIComponent(val)
          }
          return val
        }
        this.ver = this.query('ver')
      }

      get hass() {
        const homeassistant = top.document.querySelector('home-assistant')
        return homeassistant ? homeassistant.hass : null
      }

      fullscreen() {
        try {
          let haPanelIframe = top.document.body
            .querySelector("home-assistant")
            .shadowRoot.querySelector("home-assistant-main")
            .shadowRoot.querySelector("app-drawer-layout partial-panel-resolver ha-panel-iframe").shadowRoot
          let ha_card = haPanelIframe.querySelector("iframe");
          ha_card.style.position = 'absolute'
          haPanelIframe.querySelector('app-toolbar').style.display = 'none'
          ha_card.style.top = '0'
          ha_card.style.height = '100%'
        } catch {

        }
      }

      // 触发事件
      fire(type, data, ele = null) {
        console.log(type, data)
        const event = new top.Event(type, {
          bubbles: true,
          cancelable: false,
          composed: true
        });
        event.detail = data;
        if (!ele) {
          ele = top.document.querySelector("home-assistant")
            .shadowRoot.querySelector("home-assistant-main")
            .shadowRoot.querySelector("app-drawer-layout")
        }
        ele.dispatchEvent(event);
      }

      post(params) {
        return this.fetch('/ha_file_explorer-api', params, 'post')
      }

      put(params) {
        return this.fetch('/ha_file_explorer-api', params, 'put')
      }

      callService(name, params = {}) {
        const arr = name.split('.')
        return this.hass.callService(arr[0], arr[1], params)
      }

      // http请求
      async fetch(url, params, method) {
        const body = toString.call(params) == '[object FormData]' ? params : JSON.stringify(params)
        const { hass } = this
        if (!hass) {
          return fetch(top.location.origin + url, {
            method,
            body,
            headers: {
              authorization: 'Bearer ' + hass.auth.data.access_token
            }
          }).then(res => res.json())
        }
        return hass.fetchWithAuth(url, {
          method,
          body
        }).then(async res => {
          const contentType = res.headers.get('Content-Type')
          if (contentType === 'application/octet-stream') {
            const blob = await res.blob()
            let bl = new Blob([blob], { type: blob.type });
            var link = top.document.createElement('a');
            link.href = top.URL.createObjectURL(blob);
            link.download = params.path.substr(params.path.lastIndexOf('/') + 1)
            link.click();
            top.URL.revokeObjectURL(link.href)
            return { msg: '下载成功' }
          }
          return res.json()
        })
      }
    }

    window.ha = new HA();
    window.ha.fullscreen()</script>
  <script src="js/chunk-vendors.f06a1e0f.js"></script>
  <script src="js/app.356b1d21.js"></script>
</body>

</html>